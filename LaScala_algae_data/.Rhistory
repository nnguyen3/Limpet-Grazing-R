geom_boxplot(fill = "#FFB3BA") + theme_minimal() +
labs(title = "Species Richness", x = "", y = "Richness")
# richness is the number of different algae typpe on each plate
# richness across dif treatment type
# ungraze have highest richness
# graze have lower richness , mean that grazing reduce species variety
ggplot(diversity_data, aes(x = Treatment, y = Shannon)) +
geom_boxplot(fill = "#D6CDEA") + theme_minimal() +
labs(title = "Shannon Diversity", x = "", y = "Shannon")
# richness + eveness
# ungraze slightly higher diveristy
# graze lower shannon diversity, with some variation
#ungraze higher median = more species , more distribution
# graze show wider spread = diversity is reduce with grazing, low diversity with tougher typoe
# grazing not only reduce diversity but also allow dominance to survive ( skew to tougher , more resitstance tpoe)
# Rarefaction curves
# compare richness between treatment
# avoid bias
# define color by group
treatment_colors <- c(
"Ungrazed" = "red",
"Lscabra"  = "blue",
"Laustro"  = "purple",
"Natural"  = "violet")
color1 <- treatment_colors
rarecurve(abund_counts,
step = 10,
col = color1,
label = TRUE,
ylab= "species",
xlab= "sample size",
main = "Rarefaction Curves Colored by Treatment")
# red line show much higher richenss, might be ungrazed plate that have more diversity
knitr::opts_chunk$set(echo = TRUE)
# richness is to see how many different taxa
# shannon is to see both abundance and evenness
#evenness is to see how even the taxa distrbuted
# to see if grazing reduce overall diversity
# or if ungraze plot support richer, more even communities
# raw abundance data
abund_counts <- algae_data %>% select(-Treatment)
abund_counts <- round(abund_counts) # make sure values are intergers
summary(abund_counts)
str(abund_counts)
# Basic richness metrics
diversity_data <- algae_data %>%
mutate(Richness = specnumber(select(., -Treatment)),
Shannon = diversity(select(., -Treatment), index = "shannon"),
Evenness = Shannon / log(Richness))
# Plot alpha diversity
ggplot(diversity_data, aes(x = Treatment, y = Richness)) +
geom_boxplot(fill = "#FFB3BA") + theme_minimal() +
labs(title = "Species Richness", x = "", y = "Richness")
# richness is the number of different algae typpe on each plate
# richness across dif treatment type
# ungraze have highest richness
# graze have lower richness , mean that grazing reduce species variety
ggplot(diversity_data, aes(x = Treatment, y = Shannon)) +
geom_boxplot(fill = "#D6CDEA") + theme_minimal() +
labs(title = "Shannon Diversity", x = "", y = "Shannon")
# richness + eveness
# ungraze slightly higher diveristy
# graze lower shannon diversity, with some variation
#ungraze higher median = more species , more distribution
# graze show wider spread = diversity is reduce with grazing, low diversity with tougher typoe
# grazing not only reduce diversity but also allow dominance to survive ( skew to tougher , more resitstance tpoe)
# Rarefaction curves
# compare richness between treatment
# avoid bias
# define color by group
treatment_colors <- c(
"Ungrazed" = "red",
"Lscabra"  = "blue",
"Laustro"  = "purple",
"Natural"  = "yellow")
color1 <- treatment_colors
rarecurve(abund_counts,
step = 10,
col = color1,
label = TRUE,
ylab= "species",
xlab= "sample size",
main = "Rarefaction Curves Colored by Treatment")
# red line show much higher richenss, might be ungrazed plate that have more diversity
knitr::opts_chunk$set(echo = TRUE)
# richness is to see how many different taxa
# shannon is to see both abundance and evenness
#evenness is to see how even the taxa distrbuted
# to see if grazing reduce overall diversity
# or if ungraze plot support richer, more even communities
# raw abundance data
abund_counts <- algae_data %>% select(-Treatment)
abund_counts <- round(abund_counts) # make sure values are intergers
summary(abund_counts)
str(abund_counts)
# Basic richness metrics
diversity_data <- algae_all %>%
mutate(
Richness = specnumber(morpho),
Shannon = diversity(morpho, index = "shannon"),
Evenness = Shannon / log(Richness)
)
# Plot alpha diversity
ggplot(diversity_data, aes(x = Treatment, y = Richness)) +
geom_boxplot(fill = "#FFB3BA") + theme_minimal() +
labs(title = "Species Richness", x = "", y = "Richness")
# richness is the number of different algae typpe on each plate
# richness across dif treatment type
# ungraze have highest richness
# graze have lower richness , mean that grazing reduce species variety
# plot shannon
ggplot(diversity_data, aes(x = Treatment, y = Shannon)) +
geom_boxplot(fill = "#D6CDEA") + theme_minimal() +
labs(title = "Shannon Diversity by Treatment", x = "Treatment", y = "Shannon")
# richness + eveness
# ungraze slightly higher diveristy
# graze lower shannon diversity, with some variation
#ungraze higher median = more species , more distribution
# graze show wider spread = diversity is reduce with grazing, low diversity with tougher typoe
# grazing not only reduce diversity but also allow dominance to survive ( skew to tougher , more resitstance tpoe)
# Rarefaction curves
# compare richness between treatment
# avoid bias
# define color by group
treatment_colors <- c(
"Ungrazed" = "red",
"Lscabra"  = "blue",
"Laustro"  = "purple",
"Natural"  = "yellow")
color1 <- treatment_colors
rarecurve(abund_counts,
step = 10,
col = color1,
label = TRUE,
ylab= "species",
xlab= "sample size",
main = "Rarefaction Curves Colored by Treatment")
# red line- Ungraze show much higher richenss
knitr::opts_chunk$set(echo = TRUE)
# richness is to see how many different taxa
# shannon is to see both abundance and evenness
#evenness is to see how even the taxa distrbuted
# to see if grazing reduce overall diversity
# or if ungraze plot support richer, more even communities
# raw abundance data
abund_counts <- algae_data %>% select(-Treatment)
abund_counts <- round(abund_counts) # make sure values are intergers
summary(abund_counts)
str(abund_counts)
# Basic richness metrics
diversity_data <- algae_all %>%
mutate(
Richness = specnumber(morpho),
Shannon = diversity(morpho, index = "shannon"),
Evenness = Shannon / log(Richness)
)
# Plot alpha diversity
ggplot(diversity_data, aes(x = Treatment, y = Richness)) +
geom_boxplot(fill = "#FFB3BA") + theme_minimal() +
labs(title = "Species Richness by Treatment", x = "", y = "Richness")
# richness is the number of different algae typpe on each plate
# richness across dif treatment type
# ungraze have highest richness
# graze have lower richness , mean that grazing reduce species variety
# plot shannon
ggplot(diversity_data, aes(x = Treatment, y = Shannon)) +
geom_boxplot(fill = "#D6CDEA") + theme_minimal() +
labs(title = "Shannon Diversity by Treatment", x = "Treatment", y = "Shannon")
# richness + eveness
# ungraze slightly higher diveristy
# graze lower shannon diversity, with some variation
#ungraze higher median = more species , more distribution
# graze show wider spread = diversity is reduce with grazing, low diversity with tougher typoe
# grazing not only reduce diversity but also allow dominance to survive ( skew to tougher , more resitstance tpoe)
# Rarefaction curves
# compare richness between treatment
# avoid bias
# define color by group
treatment_colors <- c(
"Ungrazed" = "red",
"Lscabra"  = "blue",
"Laustro"  = "purple",
"Natural"  = "yellow")
color1 <- treatment_colors
rarecurve(abund_counts,
step = 10,
col = color1,
label = TRUE,
ylab= "species",
xlab= "sample size",
main = "Rarefaction Curves Colored by Treatment")
# red line- Ungraze show much higher richenss
knitr::opts_chunk$set(echo = TRUE)
# richness is to see how many different taxa
# shannon is to see both abundance and evenness
#evenness is to see how even the taxa distrbuted
# to see if grazing reduce overall diversity
# or if ungraze plot support richer, more even communities
# raw abundance data
abund_counts <- algae_data %>% select(-Treatment)
abund_counts <- round(abund_counts) # make sure values are intergers
summary(abund_counts)
str(abund_counts)
# Basic richness metrics
diversity_data <- algae_all %>%
mutate(
Richness = specnumber(morpho),
Shannon = diversity(morpho, index = "shannon"),
Evenness = Shannon / log(Richness)
)
# Plot alpha diversity
ggplot(diversity_data, aes(x = Treatment, y = Richness)) +
geom_boxplot(fill = "#FFB3BA") + theme_minimal() +
labs(title = "Species Richness by Treatment", x = "", y = "Richness")
# richness is the number of different algae typpe on each plate
# richness across dif treatment type
# ungraze have highest richness
# graze have lower richness , mean that grazing reduce species variety
# plot shannon
ggplot(diversity_data, aes(x = Treatment, y = Shannon)) +
geom_boxplot(fill = "#D6CDEA") + theme_minimal() +
labs(title = "Shannon Diversity by Treatment", x = "", y = "Shannon")
# richness + eveness
# ungraze slightly higher diveristy
# graze lower shannon diversity, with some variation
#ungraze higher median = more species , more distribution
# graze show wider spread = diversity is reduce with grazing, low diversity with tougher typoe
# grazing not only reduce diversity but also allow dominance to survive ( skew to tougher , more resitstance tpoe)
# Rarefaction curves
# compare richness between treatment
# avoid bias
# define color by group
treatment_colors <- c(
"Ungrazed" = "red",
"Lscabra"  = "blue",
"Laustro"  = "purple",
"Natural"  = "yellow")
color1 <- treatment_colors
rarecurve(abund_counts,
step = 10,
col = color1,
label = TRUE,
ylab= "species",
xlab= "sample size",
main = "Rarefaction Curves Colored by Treatment")
# red line- Ungraze show much higher richenss
knitr::opts_chunk$set(echo = TRUE)
rarecurve(morpho, step = 5, col = as.factor(meta$Treatment), cex = 0.6,
main = "Rarefaction Curves by Treatment")
knitr::opts_chunk$set(echo = TRUE)
# avoid log(0)
morpho_clr <- clr(morpho + 0.001)
# PCA plot
pca_clr <- prcomp(morpho_clr, center =TRUE, scale. =TRUE) # run pca on clr transformed data
# plot
autoplot(pca_clr, data = meta, colour = 'Treatment') + # plot pca
labs(title = "PCA on CLR-transformed data") +
theme_minimal()
# each point is a plate
# pc1 explain 34.07% , pc2 explain 13.86%
# ungraze plate (purple) is more seperate from other
# graze plate is more overlap, which could mean that they share similar community structure
knitr::opts_chunk$set(echo = TRUE)
# avoid log(0)
morpho_clr <- clr(morpho + 0.001)
# PCA plot
pca_clr <- prcomp(morpho_clr, center =TRUE, scale. =TRUE) # run pca on clr transformed data
# plot
autoplot(pca_clr, data = meta, colour = 'Treatment') +
stat_ellipse(aes(group = Treatment), linetype = "dashed") +
labs(title = "PCA on CLR-transformed data") +
theme_minimal() +
theme(legend.position = "right")
# each point is a plate
# pc1 explain 34.07% , pc2 explain 13.86%
# ungraze plate (purple) is more seperate from other
# graze plate is more overlap, which could mean that they share similar community structure
knitr::opts_chunk$set(echo = TRUE)
# richness is to see how many different taxa
# shannon is to see both abundance and evenness
#evenness is to see how even the taxa distrbuted
# to see if grazing reduce overall diversity
# or if ungraze plot support richer, more even communities
# raw abundance data
abund_counts <- algae_data %>% select(-Treatment)
abund_counts <- round(abund_counts) # make sure values are intergers
summary(abund_counts)
str(abund_counts)
# Basic richness metrics
diversity_data <- algae_all %>%
mutate(
Richness = specnumber(morpho),
Shannon = diversity(morpho, index = "shannon"),
Evenness = Shannon / log(Richness)
)
# Plot alpha diversity
ggplot(diversity_data, aes(x = Treatment, y = Richness)) +
geom_boxplot(fill = "#FFB3BA") + theme_minimal() +
labs(title = "Species Richness by Treatment", x = "", y = "Richness")
# richness is the number of different algae typpe on each plate
# richness across dif treatment type
# ungraze have highest richness
# graze have lower richness , mean that grazing reduce species variety
# plot shannon
ggplot(diversity_data, aes(x = Treatment, y = Shannon)) +
geom_boxplot(fill = "#D6CDEA") + theme_minimal() +
labs(title = "Shannon Diversity by Treatment", x = "", y = "Shannon")
# richness + eveness
# ungraze slightly higher diveristy
# graze lower shannon diversity, with some variation
#ungraze higher median = more species , more distribution
# graze show wider spread = diversity is reduce with grazing, low diversity with tougher typoe
# grazing not only reduce diversity but also allow dominance to survive ( skew to tougher , more resitstance tpoe)
# Rarefaction curves
# rarefaction is used to assess sampling effort when dealing with count data
# this data represent percent cover instead of raw species count => rarefaction should not use here. So i focus on richness and evennes using alpha diversity
knitr::opts_chunk$set(echo = TRUE)
library(randomForest)
knitr::opts_chunk$set(echo = TRUE)
install.packages("randomForest")
library(randomForest)
# Convert treatment to factor
meta$Treatment <- as.factor(meta$Treatment)
# Train random forest
rf_model <- randomForest(morpho_clr, y = meta$Treatment, importance = TRUE, ntree = 500)
# Plot importance
importance_df <- as.data.frame(importance(rf_model))
importance_df$Feature <- rownames(importance_df)
top_features <- importance_df %>% arrange(desc(MeanDecreaseGini)) %>% head(10)
ggplot(top_features, aes(x = reorder(Feature, MeanDecreaseGini), y = MeanDecreaseGini)) +
geom_col(fill = "lightpink") +
coord_flip() +
labs(title = "Top Features by GINI Importance", x = "Algae Type", y = "Gini Importance") +
theme_minimal()
knitr::opts_chunk$set(echo = TRUE)
# richness is to see how many different taxa
# shannon is to see both abundance and evenness
#evenness is to see how even the taxa distrbuted
# to see if grazing reduce overall diversity
# or if ungraze plot support richer, more even communities
# alpha diversity
diversity_data <- algae_all %>% # meta + morpho, creat diversity data with all data + 3 column (richness, shannon, evenness)
mutate(
Richness = specnumber(morpho), # count how many algae type are present in each row
Shannon = diversity(morpho, index = "shannon"),  # how many species , how evenly their abundancde are distribute
Evenness = Shannon / log(Richness) # cal evennes , standardize shannon by richness. show if species are equally represent or few type dominant
)
# Plot alpha diversity : richness by treatment
ggplot(diversity_data, aes(x = Treatment, y = Richness)) +
geom_boxplot(fill = "#FFB3BA") + theme_minimal() +
labs(title = "Species Richness by Treatment", x = "", y = "Richness")
# richness is the number of different algae typpe on each plate
# richness across dif treatment type
# ungraze have highest richness
# graze have lower richness , mean that grazing reduce species variety
# plot alpha diversity : shannon by treatment
ggplot(diversity_data, aes(x = Treatment, y = Shannon)) +
geom_boxplot(fill = "#D6CDEA") + theme_minimal() +
labs(title = "Shannon Diversity by Treatment", x = "", y = "Shannon")
# richness + eveness
# ungraze slightly higher diveristy
# graze lower shannon diversity, with some variation
#ungraze higher median = more species , more distribution
# graze show wider spread = diversity is reduce with grazing, low diversity with tougher typoe
# grazing not only reduce diversity but also allow dominance to survive ( skew to tougher , more resitstance tpoe)
# Rarefaction curves
# rarefaction is used to assess sampling effort when dealing with count data
# this data represent percent cover instead of raw species count => rarefaction should not use here. So i focus on richness and evennes using alpha diversity
install.packages("randomForest")
library(randomForest)
# Convert treatment to factor
meta$Treatment <- as.factor(meta$Treatment)
# Train random forest
rf_model <- randomForest(morpho_clr, y = meta$Treatment, importance = TRUE, ntree = 500)
# Plot importance
importance_df <- as.data.frame(importance(rf_model))
importance_df$Feature <- rownames(importance_df)
top_features <- importance_df %>% arrange(desc(MeanDecreaseGini)) %>% head(10)
ggplot(top_features, aes(x = reorder(Feature, MeanDecreaseGini), y = MeanDecreaseGini)) +
geom_col(fill = "lightpink") +
coord_flip() +
labs(title = "Top Features by GINI Importance", x = "Algae Type", y = "Gini Importance") +
theme_minimal()
# gini is measure that use in random forest to determine how important each variable here is morphotype
# top algae is encrust undefined (tougher and more resistent) and filcyano200x50 (soft algae)
# these alage vary a lot between treatment and help the model to distingush group
knitr::opts_chunk$set(echo = TRUE)
# richness is to see how many different taxa
# shannon is to see both abundance and evenness
#evenness is to see how even the taxa distrbuted
# to see if grazing reduce overall diversity
# or if ungraze plot support richer, more even communities
# alpha diversity
diversity_data <- algae_all %>% # meta + morpho, creat diversity data with all data + 3 column (richness, shannon, evenness)
mutate(
Richness = specnumber(morpho), # count how many algae type are present in each row
Shannon = diversity(morpho, index = "shannon"),  # how many species , how evenly their abundancde are distribute
Evenness = Shannon / log(Richness) # cal evennes , standardize shannon by richness. show if species are equally represent or few type dominant
)
knitr::opts_chunk$set(echo = TRUE)
install.packages("compositions")       #  CLR transformation
install.packages("ggfortify")  # autoplot pca
install.packages("tidyverse")
library(vegan) # nmd
library(ggplot2) # ggplot
library(dplyr)
library(reshape2)
library(pheatmap)
library(RColorBrewer)
library(tidyr)
library(compositions)
library(ggfortify)
library(tidyverse)
install.packages("tidyverse")
knitr::opts_chunk$set(echo = TRUE)
# Load dataset
algae_data <- read.csv("microalgae_community_SEM_data.csv")
# Prepare metadata and morphotypes
meta <- algae_data[, c("Site", "Treatment")] # use only the metadata colum (site number and treatment type)
morpho <- algae_data[, 3:ncol(algae_data)] # keep all coulumn from column 3 and so on ( including algae ercent cover data)
algae_all <- cbind(meta, morpho) # combine meta and morpho into 1 dataframe
# metadata (who,what treatment) : non biological info ( site, treatment)
# morpho (what kind) of algae were found, how much of each: include percent cover of each type of microalgae on each plate ( diatom, encrusting , bare space ,..) => what i want to analyze to see how grazing affect algae communities
# calc bray curtis dissimilary base on % cover
# Bray-Curtis distance
algae_bray <- vegdist(morpho, method = "bray") # see how different each plate is in term of algae composition
library(vegan) # nmd
library(ggplot2) # ggplot
library(dplyr)
library(reshape2)
library(pheatmap)
library(RColorBrewer)
library(tidyr)
library(compositions)
library(ggfortify)
library(tidyverse)
# calc bray curtis dissimilary base on % cover
# Bray-Curtis distance
algae_bray <- vegdist(morpho, method = "bray") # see how different each plate is in term of algae composition
# nMDS
# non metric multidimensional scaling using bray distance
algae_nmds <- metaMDS(algae_bray, k = 2, trymax = 100)
# Extract scores from the nmds for each plate ( for plotting)
scores <- as.data.frame(scores(algae_nmds))
# add thje treatment back so I can color point by treatment
scores$Treatment <- meta$Treatment
# make scatter plot for nmds results
# Plot nMDS
ggplot(scores, aes(x = NMDS1, y = NMDS2, color = Treatment)) +
geom_point(size = 3) +
stat_ellipse(type = "norm") +
theme_minimal() +
labs(title = "nMDS of Microalgae Communities by Treatment")
# each point is a plate , allipse show how similar the groups are
# Stress value= show how well the plot represent the data algae_nmds$stress
# 0.06 < 0.1 which is very good
# richness is to see how many different taxa
# shannon is to see both abundance and evenness
#evenness is to see how even the taxa distrbuted
# to see if grazing reduce overall diversity
# or if ungraze plot support richer, more even communities
# alpha diversity
diversity_data <- algae_all %>% # meta + morpho, creat diversity data with all data + 3 column (richness, shannon, evenness)
mutate(
Richness = specnumber(morpho), # count how many algae type are present in each row
Shannon = diversity(morpho, index = "shannon"),  # how many species , how evenly their abundancde are distribute
Evenness = Shannon / log(Richness) # cal evennes , standardize shannon by richness. show if species are equally represent or few type dominant
)
# Plot alpha diversity : richness by treatment
ggplot(diversity_data, aes(x = Treatment, y = Richness ))+
geom_boxplot(fill = "#FFB3BA") + theme_minimal() +
labs(title = "Species Richness by Treatment", x = "", y = "Richness (Number of Algal Morphotypes)")
# richness is the number of different algae typpe on each plate
# richness across dif treatment type
# ungraze have highest richness
# graze have lower richness , mean that grazing reduce species variety
# plot alpha diversity : shannon by treatment
ggplot(diversity_data, aes(x = Treatment, y = Shannon)) +
geom_boxplot(fill = "#D6CDEA") + theme_minimal() +
labs(title = "Shannon Diversity by Treatment", x = "", y = "Shannon")
# richness + eveness
# ungraze slightly higher diveristy
# graze lower shannon diversity, with some variation
#ungraze higher median = more species , more distribution
# graze show wider spread = diversity is reduce with grazing, low diversity with tougher typoe
# grazing not only reduce diversity but also allow dominance to survive ( skew to tougher , more resitstance tpoe)
# Rarefaction curves
# rarefaction is used to assess sampling effort when dealing with count data
# this data represent percent cover instead of raw species count => rarefaction should not use here. So i focus on richness and evennes using alpha diversity
knitr::opts_chunk$set(echo = TRUE)
# boxplot
# calc total algae cover by adding all morpho column
algae_all$total_cover <- rowSums(morpho)
# calc total cover for just the filamentous cyanobactereia group
algae_all$Filamentous <- rowSums(algae_all[, c("Filcyano800x150", "Filcyano200x50", "FilcyanoBead10um", "FilcyanoBeadLess10um", "FilcyanoWidthLess7um")], na.rm = TRUE)
# Boxplot 1: Total algae cover across treatments
ggplot(algae_all, aes(x = Treatment, y = total_cover)) +
geom_boxplot(fill = "lavender") +
theme_minimal() +
labs(title = "Total Algal Cover by Treatment", y = "Total % Cover")
# Boxplot 2: Filamentous Group cover across treatment
ggplot(algae_all, aes(x = Treatment, y = Filamentous)) +
geom_boxplot(fill = "plum1") +
theme_minimal() +
labs(title = "Filamentous Cyanobacteria by Treatment", y = "Total % Cover")
# Boxplot 3: a key sensitive morphotype ( filcyano 200x50)
ggplot(algae_all, aes(x = Treatment, y = Filcyano200x50)) +
geom_boxplot(fill = "lightpink") +
theme_minimal() +
labs(title = "Filamentous Cyanobacteria (200x50) by Treatment", y = "Percent Cover")
setwd("~/Desktop/Limpet Grazing/LaScala_algae_data")
save.image("~/Desktop/Limpet Grazing/LaScala_algae_data/LaScala_algae_data.RData")
